{% extends 'base.html' %}

{% block title %}Klus Aanmaken - KLUSKOMPAS{% endblock %}

{% block content %}
<div class="main-container" style="display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;">
    <div class="form-container" style="width: 400px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); background: white; overflow-y: auto;">
        <!-- Titel blijft altijd bovenaan -->
        <h1 style="text-align: center; color: white; margin-bottom: 20px; position: sticky; top: 0; background-color: #10246B; padding: 10px 0; z-index: 10; border-radius: 8px 8px 0 0; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">Klus Aanmaken</h1>
        
        <form method="POST" action="{{ url_for('main.add_klusaanbieder') }}">
            {{ form.hidden_tag() }}

            <!-- Titel -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="naam" style="font-size: 16px; font-weight: bold; color: #10246B;">Titel:</label>
                {{ form.naam(class_="form-control", placeholder="Voer een titel in") }}
            </div>

            <!-- Categorie -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="categorie" style="font-size: 16px; font-weight: bold; color: #10246B;">Categorie:</label>
                {{ form.categorie(class_="form-control") }}
            </div>

            <!-- Stad -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="stad" style="font-size: 16px; font-weight: bold; color: #10246B;">Stad:</label>
                {{ form.stad(class_="form-control", placeholder="Voer een Stad in") }}
                <ul id="stad-suggesties" style="list-style: none; padding: 0; margin-top: 5px; display: none; border: 1px solid #ccc; max-height: 200px; overflow-y: auto;"></ul>
            </div>

            <!-- Adres -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="adres" style="font-size: 16px; font-weight: bold; color: #10246B;">Adres:</label>
                {{ form.adres(class_="form-control", placeholder="Voer een adres in") }}
                <ul id="adres-suggesties" style="list-style: none; padding: 0; margin-top: 5px; display: none; border: 1px solid #ccc; max-height: 200px; overflow-y: auto;"></ul>
            </div>

            <!-- Beschrijving -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="beschrijving" style="font-size: 16px; font-weight: bold; color: #10246B;">Beschrijving:</label>
                {{ form.beschrijving(class_="form-control", placeholder="Beschrijf de klus") }}
            </div>

            <!-- Datum -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="datum" style="font-size: 16px; font-weight: bold; color: #10246B;">Datum:</label>
                {{ form.datum(class_="form-control", placeholder="Selecteer een datum") }}
            </div>

            <!-- Tijd -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="tijd" style="font-size: 16px; font-weight: bold; color: #10246B;">Tijd:</label>
                <div style="display: flex; gap: 5px;">
                    {{ form.uren(class_="form-control", id="tijd-uren", style="width: 50%;") }}
                    {{ form.minuten(class_="form-control", id="tijd-minuten", style="width: 50%;") }}
                </div>
            </div>

            <!-- Geschatte duur -->
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="verwachte_duur" style="font-size: 16px; font-weight: bold; color: #10246B;">Geschatte duur:</label>
                {{ form.verwachte_duur(class_="form-control", placeholder="Voer de geschatte duur in") }}
            </div>

            <!-- Vergoeding -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="vergoeding" style="font-size: 16px; font-weight: bold; color: #10246B;">Vergoeding:</label>
                {{ form.vergoeding(class_="form-control", placeholder="Voer de vergoeding in") }}
            </div>

            <!-- Aanmaken knop -->
            <button type="submit" style="width: 100%; padding: 12px; font-size: 18px; background: #10246B; color: white; border: none; border-radius: 8px; cursor: pointer;">Aanmaken</button>
        </form>
    </div>
</div>

<!-- Stijlen behouden -->
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        background-color: #f4f4f9;
    }

    .form-container {
        margin-top: 50px;
        max-height: 90vh;
        overflow-y: auto;
    }

    .form-control {
        padding: 10px;
        font-size: 16px;
        border-radius: 8px;
        border: 1px solid #B2B2B2;
    }

    .form-control:focus {
        outline: none;
        border-color: #10246B;
    }

    #stad-suggesties, #adres-suggesties {
        list-style: none;
        padding: 0;
        margin-top: 5px;
        display: none;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
    }

    #stad-suggesties li, #adres-suggesties li {
        padding: 8px;
        cursor: pointer;
        background-color: #fff;
    }

    #stad-suggesties li:hover, #adres-suggesties li:hover {
        background-color: #f0f0f0;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stadInput = document.getElementById('stad');
        const adresInput = document.getElementById('adres');
        const stadSuggesties = document.getElementById('stad-suggesties');
        const adresSuggesties = document.getElementById('adres-suggesties');
        let geselecteerdeStad = null;

        stadInput.addEventListener('input', function() {
            const query = stadInput.value.trim();
            if (query.length < 3) {
                stadSuggesties.style.display = 'none';
                return;
            }

            fetch(`https://nominatim.openstreetmap.org/search?q=${query}&format=json&addressdetails=1&limit=5`)
                .then(response => response.json())
                .then(data => {
                    stadSuggesties.innerHTML = '';
                    stadSuggesties.style.display = 'block';
                    data.forEach(location => {
                        const li = document.createElement('li');
                        li.textContent = location.display_name;
                        li.addEventListener('click', function() {
                            stadInput.value = location.display_name;
                            geselecteerdeStad = location;
                            stadSuggesties.style.display = 'none';
                            adresInput.disabled = false;
                        });
                        stadSuggesties.appendChild(li);
                    });
                });
        });

        adresInput.addEventListener('input', function() {
            if (!geselecteerdeStad) return;
            const query = adresInput.value.trim();
            if (query.length < 3) {
                adresSuggesties.style.display = 'none';
                return;
            }

            fetch(`https://nominatim.openstreetmap.org/search?q=${query},${geselecteerdeStad.display_name}&format=json&addressdetails=1&limit=5`)
                .then(response => response.json())
                .then(data => {
                    adresSuggesties.innerHTML = '';
                    adresSuggesties.style.display = 'block';
                    data.forEach(location => {
                        const li = document.createElement('li');
                        li.textContent = `${location.address.road || ''} ${location.address.house_number || ''}`;
                        li.addEventListener('click', function() {
                            adresInput.value = `${location.address.road || ''} ${location.address.house_number || ''}`;
                            adresSuggesties.style.display = 'none';
                        });
                        adresSuggesties.appendChild(li);
                    });
                });
        });

        document.addEventListener('click', function(event) {
            if (!event.target.closest('#stad') && !event.target.closest('#adres')) {
                stadSuggesties.style.display = 'none';
                adresSuggesties.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
